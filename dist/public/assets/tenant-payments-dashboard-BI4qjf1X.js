import{r as o,j as e}from"./ui-DbSH5uIw.js";import{y as A,u as E,z as L,a as I,N as P,K as k,C as i,Z as B,q as O,n as M,ai as w,B as j,aB as m,c as D,r as q,o as z}from"./index-C3yA2dmm.js";import{u as Y,a as H}from"./query-C11-Me4M.js";import"./vendor-15WF5uYg.js";import"./charts-DfbWf95P.js";function J(){o.useEffect(()=>{A({title:"Payments - Choice Properties",description:"Manage your rent and security deposit payments.",url:"https://choiceproperties.com/tenant-payments"})},[]);const{user:K,isLoggedIn:F}=E(),[,C]=L(),{toast:d}=I();if(!F)return C("/login"),null;const{data:c,isLoading:S}=Y({queryKey:["/api/applications/tenant"]}),[l,f]=o.useState([]),[$,b]=o.useState(!1);o.useEffect(()=>{if(!c||c.length===0)return;(async()=>{b(!0);try{const t=[];for(const g of c){const r=await fetch(`/api/applications/${g.id}/payments`);if(r.ok){const v=await r.json();v.data&&t.push(...v.data)}}f(t)}catch(t){console.error("Failed to fetch payments:",t),d({title:"Error",description:"Failed to load your payments.",variant:"destructive"})}finally{b(!1)}})()},[c,d]);const n=H({mutationFn:async s=>await q(`/api/v2/payments/${s}/mark-paid`,"POST"),onSuccess:(s,t)=>{d({title:"Success",description:"Payment marked as paid."}),f(g=>g.map(r=>r.id===t?{...r,status:"paid"}:r))},onError:()=>{d({title:"Error",description:"Failed to mark payment as paid. Please try again.",variant:"destructive"})}}),N=s=>()=>{n.mutate(s)},x=s=>{switch(s){case"verified":return"bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-400";case"paid":return"bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-400";case"overdue":return"bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-400";case"pending":default:return"bg-amber-100 dark:bg-amber-900 text-amber-700 dark:text-amber-400"}},u=s=>{switch(s){case"verified":case"paid":return e.jsx(M,{className:"w-4 h-4"});case"overdue":return e.jsx(w,{className:"w-4 h-4"});case"pending":default:return e.jsx(z,{className:"w-4 h-4"})}},h=l.filter(s=>s.status==="pending").sort((s,t)=>new Date(s.dueDate).getTime()-new Date(t.dueDate).getTime()),p=l.filter(s=>["paid","verified"].includes(s.status)),a=l.filter(s=>s.status==="overdue"),y=h.reduce((s,t)=>s+t.amount,0)+a.reduce((s,t)=>s+t.amount,0),R=p.reduce((s,t)=>s+t.amount,0);if(S||$)return e.jsxs(e.Fragment,{children:[e.jsx(P,{}),e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading your payments..."})}),e.jsx(k,{})]});const T=l.length>0;return e.jsxs(e.Fragment,{children:[e.jsx(P,{}),e.jsx("main",{className:"min-h-screen bg-background py-12",children:e.jsxs("div",{className:"container max-w-6xl mx-auto px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Your Payments"}),e.jsx("p",{className:"text-muted-foreground",children:"Track your rent and security deposit payments"})]}),T?e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Outstanding"}),e.jsxs("p",{className:"text-3xl font-bold",children:["$",y.toFixed(2)]})]}),y>0&&e.jsx(O,{className:"w-8 h-8 text-amber-500"})]})}),e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Paid"}),e.jsxs("p",{className:"text-3xl font-bold",children:["$",R.toFixed(2)]})]}),e.jsx(M,{className:"w-8 h-8 text-green-500"})]})})]}),a.length>0&&e.jsxs("div",{className:"p-4 bg-amber-50 dark:bg-amber-950 border border-amber-200 dark:border-amber-800 rounded-lg flex gap-3",children:[e.jsx(w,{className:"w-5 h-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-amber-900 dark:text-amber-200",children:[a.length," Payment",a.length>1?"s":""," Due"]}),e.jsxs("p",{className:"text-sm text-amber-800 dark:text-amber-300",children:["You have $",a.reduce((s,t)=>s+t.amount,0).toFixed(2)," in payments that are overdue. Please address these at your earliest convenience."]})]})]}),h.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Upcoming Payments"}),e.jsx("div",{className:"space-y-3",children:h.map(s=>e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"font-semibold",children:s.type==="rent"?"Monthly Rent":"Security Deposit"}),e.jsx(j,{className:x(s.status),children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:[u(s.status),s.status.charAt(0).toUpperCase()+s.status.slice(1)]})})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:["Due: ",m(new Date(s.dueDate),"MMMM dd, yyyy")]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Ref: ",s.referenceId]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold",children:["$",s.amount.toFixed(2)]}),s.status==="pending"&&e.jsx(D,{size:"sm",className:"mt-2",onClick:N(s.id),disabled:n.isPending,"data-testid":`button-mark-paid-${s.id}`,children:n.isPending?"Processing...":"Mark Paid"})]})]})},s.id))})]}),a.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Payments Requiring Attention"}),e.jsx("div",{className:"space-y-3",children:a.map(s=>e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"font-semibold",children:s.type==="rent"?"Monthly Rent":"Security Deposit"}),e.jsx(j,{className:x(s.status),children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:[u(s.status),"Overdue"]})})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:["Due date: ",m(new Date(s.dueDate),"MMMM dd, yyyy")]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Reference: ",s.referenceId]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold",children:["$",s.amount.toFixed(2)]}),e.jsx(D,{size:"sm",className:"mt-2",onClick:N(s.id),disabled:n.isPending,"data-testid":`button-mark-paid-overdue-${s.id}`,children:n.isPending?"Processing...":"Mark Paid"})]})]})},s.id))})]}),p.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Payment History"}),e.jsx("div",{className:"space-y-3",children:p.map(s=>e.jsx(i,{className:"p-4 opacity-75",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"font-semibold text-muted-foreground",children:s.type==="rent"?"Monthly Rent":"Security Deposit"}),e.jsx(j,{className:x(s.status),children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:[u(s.status),s.status==="verified"?"Verified":"Paid"]})})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:["Due: ",m(new Date(s.dueDate),"MMMM dd, yyyy")]}),s.paidDate&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Paid: ",m(new Date(s.paidDate),"MMMM dd, yyyy")]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Ref: ",s.referenceId]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-2xl font-bold",children:["$",s.amount.toFixed(2)]})})]})},s.id))})]})]}):e.jsxs(i,{className:"p-8 text-center",children:[e.jsx(B,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"No Active Payments"}),e.jsx("p",{className:"text-muted-foreground",children:"You don't have any active payment obligations yet. Once your lease is accepted, your payment schedule will appear here."})]})]})}),e.jsx(k,{})]})}export{J as default};
