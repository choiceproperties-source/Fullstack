import{r as m,j as e}from"./ui-DbSH5uIw.js";import{ad as $,u as I,a as P,y as L,N as c,a4 as x,ag as M,K as g,C as n,l as d,Y as i,c as s,q as y,O as j,B as S,m as b,L as T,r as F,o as w,A as q,_ as B}from"./index-C3yA2dmm.js";import{c as E,a as W,u as z}from"./query-C11-Me4M.js";import{A as R,a as V,b as H,c as K,d as Q,e as Y,f as U,g as O,h as X}from"./alert-dialog-D8ssqHVu.js";import"./vendor-15WF5uYg.js";import"./charts-DfbWf95P.js";const G=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],J=$("log-in",G);function Z(a){return{id:a.id,propertyId:a.property_id,userId:a.user_id,status:a.status||"draft",step:a.step||0,score:a.score,createdAt:a.created_at,updatedAt:a.updated_at,property:a.properties?{id:a.properties.id,title:a.properties.title,address:a.properties.address,city:a.properties.city,state:a.properties.state}:void 0}}function de(){const{user:a,isLoading:f}=I(),{toast:p}=P(),k=E(),[ee,u]=m.useState(null);m.useEffect(()=>{L({title:"My Applications - Choice Properties",description:"View and track your rental applications."})},[]);const l=W({mutationFn:async t=>F("PATCH",`/api/v2/applications/${t}/status`,{status:"withdrawn",reason:"Applicant withdrew application"}),onSuccess:()=>{p({title:"Application withdrawn successfully"}),k.invalidateQueries({queryKey:["/api/v2/applications/user",a?.id]}),u(null)},onError:t=>{p({title:"Failed to withdraw application",description:t.message,variant:"destructive"}),u(null)}}),N=t=>["draft","pending","under_review","pending_verification"].includes(t),{data:o,isLoading:v,error:A}=z({queryKey:["/api/v2/applications/user",a?.id],queryFn:async()=>{const t=await B(),r=await fetch(`/api/v2/applications/user/${a.id}`,{headers:t?{Authorization:`Bearer ${t}`}:{},credentials:"include"});if(!r.ok)throw new Error("Failed to fetch applications");return r.json()},enabled:!!a?.id}),h=o?.success&&o?.data?o.data.map(Z):[],C=t=>{switch(t){case"approved":case"approved_pending_lease":return e.jsx(q,{className:"h-5 w-5 text-green-500"});case"rejected":return e.jsx(b,{className:"h-5 w-5 text-red-500"});case"under_review":case"pending_verification":return e.jsx(w,{className:"h-5 w-5 text-blue-500"});case"pending":return e.jsx(w,{className:"h-5 w-5 text-yellow-500"});case"withdrawn":case"expired":return e.jsx(y,{className:"h-5 w-5 text-gray-500"});default:return e.jsx(j,{className:"h-5 w-5 text-gray-500 dark:text-gray-400"})}},_=t=>{const r={approved:"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200",approved_pending_lease:"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200",rejected:"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200",under_review:"bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200",pending_verification:"bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200",pending:"bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200",draft:"bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-200",withdrawn:"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400",expired:"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400"};return r[t]||r.draft},D=t=>({draft:"Draft",pending:"Pending",under_review:"Under Review",pending_verification:"Pending Verification",approved:"Approved",approved_pending_lease:"Approved - Pending Lease",rejected:"Rejected",withdrawn:"Withdrawn",expired:"Expired"})[t]||t;return f||v?e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx(c,{}),e.jsx("div",{className:"py-12 px-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx(x,{items:[{label:"My Applications"}]}),e.jsx("h1",{className:"text-2xl font-bold my-6",children:"My Applications"}),e.jsx(M,{})]})}),e.jsx(g,{})]}):a?e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx(c,{}),e.jsx(x,{items:[{label:"My Applications"}]}),e.jsx("div",{className:"flex-1 py-12 px-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("h1",{className:"text-4xl font-bold text-primary mb-2","data-testid":"text-page-title",children:"My Applications"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-8",children:"Track all your rental applications in one place."}),A&&e.jsx(n,{className:"mb-6 border-l-4 border-l-red-500 bg-red-50 dark:bg-red-950",children:e.jsxs(d,{className:"py-4 flex items-start gap-3",children:[e.jsx(y,{className:"h-5 w-5 text-red-600 dark:text-red-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-red-800 dark:text-red-200 font-medium",children:"Failed to load applications"}),e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm mt-1",children:"There was an error loading your applications. Please refresh the page or try again later."})]})]})}),h.length===0?e.jsx(n,{children:e.jsxs(d,{className:"py-16 text-center",children:[e.jsx(j,{className:"h-16 w-16 text-gray-300 dark:text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"No Applications Yet"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Start browsing properties and submit your first application."}),e.jsx(i,{href:"/properties",children:e.jsx(s,{"data-testid":"button-browse-properties",children:"Browse Properties"})})]})}):e.jsx("div",{className:"space-y-4",children:h.map(t=>e.jsx(n,{className:"hover:shadow-lg transition-shadow","data-testid":`card-application-${t.id}`,children:e.jsxs(d,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-1 truncate","data-testid":`text-property-title-${t.id}`,children:t.property?.title||"Property Application"}),t.property&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:[t.property.address,", ",t.property.city,", ",t.property.state]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Applied on ",t.createdAt?new Date(t.createdAt).toLocaleDateString():"Unknown date"]}),t.score&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Application Score: ",t.score]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[C(t.status),e.jsx(S,{className:_(t.status),"data-testid":`badge-status-${t.id}`,children:D(t.status)})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4 flex-wrap",children:[e.jsx(i,{href:`/applications/${t.id}`,children:e.jsx(s,{size:"sm","data-testid":`button-view-details-${t.id}`,children:"View Details"})}),t.propertyId&&e.jsx(i,{href:`/property/${t.propertyId}`,children:e.jsx(s,{variant:"outline",size:"sm","data-testid":`button-view-property-${t.id}`,children:"View Property"})}),t.status==="draft"&&e.jsx(i,{href:`/apply?propertyId=${t.propertyId}&applicationId=${t.id}`,children:e.jsx(s,{size:"sm",variant:"outline","data-testid":`button-continue-application-${t.id}`,children:"Continue Application"})}),N(t.status)&&e.jsxs(R,{children:[e.jsx(V,{asChild:!0,children:e.jsxs(s,{variant:"outline",size:"sm",className:"text-orange-600 border-orange-300","data-testid":`button-withdraw-${t.id}`,children:[e.jsx(b,{className:"h-4 w-4 mr-1"}),"Withdraw"]})}),e.jsxs(H,{children:[e.jsxs(K,{children:[e.jsx(Q,{children:"Withdraw Application"}),e.jsx(Y,{children:"Are you sure you want to withdraw this application? This action cannot be undone. You may need to submit a new application if you change your mind."})]}),e.jsxs(U,{children:[e.jsx(O,{children:"Cancel"}),e.jsxs(X,{onClick:()=>l.mutate(t.id),className:"bg-orange-600 hover:bg-orange-700",disabled:l.isPending,"data-testid":`button-confirm-withdraw-${t.id}`,children:[l.isPending?e.jsx(T,{className:"h-4 w-4 animate-spin mr-2"}):null,"Confirm Withdrawal"]})]})]})]})]})]})},t.id))})]})}),e.jsx(g,{})]}):e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx(c,{}),e.jsx(x,{items:[{label:"My Applications"}]}),e.jsx("div",{className:"flex-1 py-12 px-4",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx(n,{children:e.jsxs(d,{className:"py-16 text-center",children:[e.jsx(J,{className:"h-16 w-16 text-gray-300 dark:text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Sign In Required"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Please sign in to view your rental applications."}),e.jsx(i,{href:"/login",children:e.jsx(s,{"data-testid":"button-login",children:"Sign In"})})]})})})}),e.jsx(g,{})]})}export{de as default};
