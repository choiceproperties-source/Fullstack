import{c as Ce,r as x,f as oe,j as e,U as Ae,e as V,h as ke,g as Ze,u as Re,o as es,R as v,d as ss,M as ts}from"./ui-DbSH5uIw.js";import{t as le,a6 as as,a as rs,u as _e,r as se,B as b,o as te,C as y,a8 as ge,c as p,L as K,Z as ns,ah as is,a1 as fe,O as Y,ai as ve,n as os,D as ls,b as cs,m as W,d as ds,e as ms,f as xs,J as us,S as hs,g as ps,h as js,i as gs,j as fs,Q as ae,k as vs,p as Ns,U as bs,aj as ys,ak as ws,al as Cs,am as As,y as ks,N as z,K as U,l as $,Y as F,q as Rs,a4 as _s,F as Ne,an as B,G as Ss,_ as Is}from"./index-C3yA2dmm.js";import{c as Ps,a as re,u as Ds}from"./query-C11-Me4M.js";import{P as Es}from"./progress-BHXBwQCL.js";import{A as Ts,a as Hs,b as Os,c as Fs,d as Ms,e as Ls,f as $s,g as Bs,h as Vs}from"./alert-dialog-D8ssqHVu.js";import{B as be}from"./briefcase-EFKpiKWl.js";import{A as ye}from"./arrow-left-DiT6yHBU.js";import"./vendor-15WF5uYg.js";import"./charts-DfbWf95P.js";var G="Collapsible",[qs,Se]=Ce(G),[Ws,ce]=qs(G),Ie=x.forwardRef((s,o)=>{const{__scopeCollapsible:r,open:n,defaultOpen:l,disabled:i,onOpenChange:c,...d}=s,[a,h]=oe({prop:n,defaultProp:l??!1,onChange:c,caller:G});return e.jsx(Ws,{scope:r,disabled:i,contentId:Ae(),open:a,onOpenToggle:x.useCallback(()=>h(u=>!u),[h]),children:e.jsx(V.div,{"data-state":me(a),"data-disabled":i?"":void 0,...d,ref:o})})});Ie.displayName=G;var Pe="CollapsibleTrigger",De=x.forwardRef((s,o)=>{const{__scopeCollapsible:r,...n}=s,l=ce(Pe,r);return e.jsx(V.button,{type:"button","aria-controls":l.contentId,"aria-expanded":l.open||!1,"data-state":me(l.open),"data-disabled":l.disabled?"":void 0,disabled:l.disabled,...n,ref:o,onClick:ke(s.onClick,l.onOpenToggle)})});De.displayName=Pe;var de="CollapsibleContent",Ee=x.forwardRef((s,o)=>{const{forceMount:r,...n}=s,l=ce(de,s.__scopeCollapsible);return e.jsx(Ze,{present:r||l.open,children:({present:i})=>e.jsx(zs,{...n,ref:o,present:i})})});Ee.displayName=de;var zs=x.forwardRef((s,o)=>{const{__scopeCollapsible:r,present:n,children:l,...i}=s,c=ce(de,r),[d,a]=x.useState(n),h=x.useRef(null),u=Re(o,h),f=x.useRef(0),C=f.current,R=x.useRef(0),T=R.current,A=c.open||d,N=x.useRef(A),k=x.useRef(void 0);return x.useEffect(()=>{const m=requestAnimationFrame(()=>N.current=!1);return()=>cancelAnimationFrame(m)},[]),es(()=>{const m=h.current;if(m){k.current=k.current||{transitionDuration:m.style.transitionDuration,animationName:m.style.animationName},m.style.transitionDuration="0s",m.style.animationName="none";const D=m.getBoundingClientRect();f.current=D.height,R.current=D.width,N.current||(m.style.transitionDuration=k.current.transitionDuration,m.style.animationName=k.current.animationName),a(n)}},[c.open,n]),e.jsx(V.div,{"data-state":me(c.open),"data-disabled":c.disabled?"":void 0,id:c.contentId,hidden:!A,...i,ref:u,style:{"--radix-collapsible-content-height":C?`${C}px`:void 0,"--radix-collapsible-content-width":T?`${T}px`:void 0,...s.style},children:A&&l})});function me(s){return s?"open":"closed"}var Us=Ie,Ks=De,Ys=Ee,w="Accordion",Qs=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[xe,Gs,Js]=ss(w),[J]=Ce(w,[Js,Se]),ue=Se(),Te=v.forwardRef((s,o)=>{const{type:r,...n}=s,l=n,i=n;return e.jsx(xe.Provider,{scope:s.__scopeAccordion,children:r==="multiple"?e.jsx(st,{...i,ref:o}):e.jsx(et,{...l,ref:o})})});Te.displayName=w;var[He,Xs]=J(w),[Oe,Zs]=J(w,{collapsible:!1}),et=v.forwardRef((s,o)=>{const{value:r,defaultValue:n,onValueChange:l=()=>{},collapsible:i=!1,...c}=s,[d,a]=oe({prop:r,defaultProp:n??"",onChange:l,caller:w});return e.jsx(He,{scope:s.__scopeAccordion,value:v.useMemo(()=>d?[d]:[],[d]),onItemOpen:a,onItemClose:v.useCallback(()=>i&&a(""),[i,a]),children:e.jsx(Oe,{scope:s.__scopeAccordion,collapsible:i,children:e.jsx(Fe,{...c,ref:o})})})}),st=v.forwardRef((s,o)=>{const{value:r,defaultValue:n,onValueChange:l=()=>{},...i}=s,[c,d]=oe({prop:r,defaultProp:n??[],onChange:l,caller:w}),a=v.useCallback(u=>d((f=[])=>[...f,u]),[d]),h=v.useCallback(u=>d((f=[])=>f.filter(C=>C!==u)),[d]);return e.jsx(He,{scope:s.__scopeAccordion,value:c,onItemOpen:a,onItemClose:h,children:e.jsx(Oe,{scope:s.__scopeAccordion,collapsible:!0,children:e.jsx(Fe,{...i,ref:o})})})}),[tt,X]=J(w),Fe=v.forwardRef((s,o)=>{const{__scopeAccordion:r,disabled:n,dir:l,orientation:i="vertical",...c}=s,d=v.useRef(null),a=Re(d,o),h=Gs(r),f=ts(l)==="ltr",C=ke(s.onKeyDown,R=>{if(!Qs.includes(R.key))return;const T=R.target,A=h().filter(j=>!j.ref.current?.disabled),N=A.findIndex(j=>j.ref.current===T),k=A.length;if(N===-1)return;R.preventDefault();let m=N;const D=0,E=k-1,M=()=>{m=N+1,m>E&&(m=D)},L=()=>{m=N-1,m<D&&(m=E)};switch(R.key){case"Home":m=D;break;case"End":m=E;break;case"ArrowRight":i==="horizontal"&&(f?M():L());break;case"ArrowDown":i==="vertical"&&M();break;case"ArrowLeft":i==="horizontal"&&(f?L():M());break;case"ArrowUp":i==="vertical"&&L();break}const q=m%k;A[q].ref.current?.focus()});return e.jsx(tt,{scope:r,disabled:n,direction:l,orientation:i,children:e.jsx(xe.Slot,{scope:r,children:e.jsx(V.div,{...c,"data-orientation":i,ref:a,onKeyDown:n?void 0:C})})})}),Q="AccordionItem",[at,he]=J(Q),Me=v.forwardRef((s,o)=>{const{__scopeAccordion:r,value:n,...l}=s,i=X(Q,r),c=Xs(Q,r),d=ue(r),a=Ae(),h=n&&c.value.includes(n)||!1,u=i.disabled||s.disabled;return e.jsx(at,{scope:r,open:h,disabled:u,triggerId:a,children:e.jsx(Us,{"data-orientation":i.orientation,"data-state":We(h),...d,...l,ref:o,disabled:u,open:h,onOpenChange:f=>{f?c.onItemOpen(n):c.onItemClose(n)}})})});Me.displayName=Q;var Le="AccordionHeader",$e=v.forwardRef((s,o)=>{const{__scopeAccordion:r,...n}=s,l=X(w,r),i=he(Le,r);return e.jsx(V.h3,{"data-orientation":l.orientation,"data-state":We(i.open),"data-disabled":i.disabled?"":void 0,...n,ref:o})});$e.displayName=Le;var ie="AccordionTrigger",Be=v.forwardRef((s,o)=>{const{__scopeAccordion:r,...n}=s,l=X(w,r),i=he(ie,r),c=Zs(ie,r),d=ue(r);return e.jsx(xe.ItemSlot,{scope:r,children:e.jsx(Ks,{"aria-disabled":i.open&&!c.collapsible||void 0,"data-orientation":l.orientation,id:i.triggerId,...d,...n,ref:o})})});Be.displayName=ie;var Ve="AccordionContent",qe=v.forwardRef((s,o)=>{const{__scopeAccordion:r,...n}=s,l=X(w,r),i=he(Ve,r),c=ue(r);return e.jsx(Ys,{role:"region","aria-labelledby":i.triggerId,"data-orientation":l.orientation,...c,...n,ref:o,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...s.style}})});qe.displayName=Ve;function We(s){return s?"open":"closed"}var rt=Te,nt=Me,it=$e,ze=Be,Ue=qe;const ot=rt,S=x.forwardRef(({className:s,...o},r)=>e.jsx(nt,{ref:r,className:le("border-b",s),...o}));S.displayName="AccordionItem";const I=x.forwardRef(({className:s,children:o,...r},n)=>e.jsx(it,{className:"flex",children:e.jsxs(ze,{ref:n,className:le("flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline text-left [&[data-state=open]>svg]:rotate-180",s),...r,children:[o,e.jsx(as,{className:"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200"})]})}));I.displayName=ze.displayName;const P=x.forwardRef(({className:s,children:o,...r},n)=>e.jsx(Ue,{ref:n,className:"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...r,children:e.jsx("div",{className:le("pb-4 pt-0",s),children:o})}));P.displayName=Ue.displayName;const ne={draft:"bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-200",pending:"bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200",under_review:"bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200",pending_verification:"bg-orange-100 dark:bg-orange-900 text-orange-800 dark:text-orange-200",approved:"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200",approved_pending_lease:"bg-emerald-100 dark:bg-emerald-900 text-emerald-800 dark:text-emerald-200",rejected:"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200",withdrawn:"bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-200",expired:"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400"},we=[{value:"income",label:"Insufficient Income"},{value:"credit",label:"Credit Issues"},{value:"rental_history",label:"Rental History Concerns"},{value:"background_check",label:"Background Check Failed"},{value:"incomplete_application",label:"Incomplete Application"},{value:"documents",label:"Missing/Invalid Documents"},{value:"other",label:"Other"}];function lt({application:s,onClose:o,onStatusChange:r}){const{toast:n}=rs(),l=Ps(),{user:i}=_e(),[c,d]=x.useState(!1),[a,h]=x.useState(!1),[u,f]=x.useState(""),[C,R]=x.useState(""),[T,A]=x.useState(""),[N,k]=x.useState(""),[m,D]=x.useState(!0),E=i?.id===s.userId,M=i?.role==="admin"||i?.role==="owner",L=E&&["draft","pending","under_review","pending_verification"].includes(s.status),q=M&&!E,j=re({mutationFn:async({status:t,options:_})=>se("PATCH",`/api/v2/applications/${s.id}/status`,{status:t,..._}),onSuccess:()=>{n({title:"Status updated successfully"}),l.invalidateQueries({queryKey:["/api/v2/applications"]}),r?.()},onError:t=>{n({title:"Failed to update status",description:t.message,variant:"destructive"})}}),pe=re({mutationFn:async()=>se("POST",`/api/applications/${s.id}/comments`,{content:N,isInternal:m}),onSuccess:()=>{n({title:"Comment added"}),k(""),l.invalidateQueries({queryKey:["/api/v2/applications",s.id]})},onError:()=>{n({title:"Failed to add comment",variant:"destructive"})}}),O=re({mutationFn:async()=>se("POST",`/api/applications/${s.id}/score`),onSuccess:()=>{n({title:"Score recalculated"}),l.invalidateQueries({queryKey:["/api/v2/applications",s.id]}),r?.()},onError:()=>{n({title:"Failed to recalculate score",variant:"destructive"})}}),Ke=()=>{j.mutate({status:"approved"})},Ye=()=>{j.mutate({status:"rejected",options:{rejectionCategory:u,rejectionReason:C,rejectionDetails:{categories:[u],explanation:C,appealable:u!=="background_check"}}}),d(!1)},Qe=()=>{j.mutate({status:"under_review"})},Ge=()=>{j.mutate({status:"pending_verification"})},Je=()=>{j.mutate({status:"withdrawn",options:{reason:T||"Applicant withdrew application"}}),h(!1),A("")},H=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),Z=t=>t.replace(/_/g," ").replace(/\b\w/g,_=>_.toUpperCase()),g=s.scoreBreakdown,Xe=g?Math.round(g.totalScore/g.maxScore*100):0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start gap-4 flex-wrap",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground","data-testid":"text-applicant-name",children:s.users?.fullName||"Applicant"}),e.jsx("p",{className:"text-muted-foreground","data-testid":"text-applicant-email",children:s.users?.email}),s.users?.phone&&e.jsx("p",{className:"text-muted-foreground text-sm",children:s.users.phone})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(b,{className:ne[s.status],"data-testid":"badge-application-status",children:Z(s.status)}),s.expiresAt&&e.jsxs(b,{variant:"outline",className:"text-orange-600 border-orange-300",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),"Expires ",H(s.expiresAt)]})]})]}),g?e.jsxs(y,{className:"p-6","data-testid":"card-score-breakdown",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"font-semibold text-lg flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5 text-yellow-500"}),"Application Score"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl font-bold text-foreground",children:g.totalScore}),e.jsxs("span",{className:"text-muted-foreground",children:["/ ",g.maxScore]}),q&&e.jsx(p,{size:"sm",variant:"outline",onClick:()=>O.mutate(),disabled:O.isPending,"data-testid":"button-recalculate-score",children:O.isPending?e.jsx(K,{className:"h-4 w-4 animate-spin"}):"Recalculate"})]})]}),e.jsx(Es,{value:Xe,className:"h-3 mb-6"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[{label:"Income",value:g.incomeScore,max:25,icon:ns},{label:"Credit",value:g.creditScore,max:25,icon:is},{label:"Rental History",value:g.rentalHistoryScore,max:20,icon:fe},{label:"Employment",value:g.employmentScore,max:15,icon:be},{label:"Documents",value:g.documentsScore,max:15,icon:Y}].map(t=>e.jsxs("div",{className:"text-center",children:[e.jsx(t.icon,{className:"h-5 w-5 mx-auto mb-1 text-muted-foreground"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.label}),e.jsxs("p",{className:"font-semibold text-foreground",children:[t.value,"/",t.max]})]},t.label))}),!E&&g.flags&&g.flags.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Flags:"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:g.flags.map(t=>e.jsxs(b,{variant:"outline",className:"text-orange-600 border-orange-300",children:[e.jsx(ve,{className:"h-3 w-3 mr-1"}),t.replace(/_/g," ")]},t))})]})]}):s.status!=="draft"&&e.jsx(y,{className:"p-6","data-testid":"card-score-pending",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ge,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"Application Score"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:E?"Your application score will be available after the property manager reviews your submission.":"Score not yet calculated. Click 'Calculate Score' to generate the application score."})]}),q&&e.jsxs(p,{size:"sm",onClick:()=>O.mutate(),disabled:O.isPending,className:"ml-auto","data-testid":"button-calculate-score",children:[O.isPending?e.jsx(K,{className:"h-4 w-4 animate-spin mr-2"}):null,"Calculate Score"]})]})}),["pending","under_review","pending_verification"].includes(s.status)&&e.jsx(y,{className:"p-4","data-testid":"card-actions",children:e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[s.status==="pending"&&e.jsxs(p,{onClick:Qe,disabled:j.isPending,"data-testid":"button-start-review",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Start Review"]}),["under_review","pending_verification"].includes(s.status)&&e.jsxs(e.Fragment,{children:[e.jsxs(p,{onClick:Ke,disabled:j.isPending,className:"bg-green-600 hover:bg-green-700","data-testid":"button-approve",children:[e.jsx(os,{className:"h-4 w-4 mr-2"}),"Approve"]}),e.jsxs(ls,{open:c,onOpenChange:d,children:[e.jsx(cs,{asChild:!0,children:e.jsxs(p,{variant:"destructive","data-testid":"button-reject-open",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Reject"]})}),e.jsxs(ds,{children:[e.jsx(ms,{children:"Reject Application"}),e.jsx(xs,{children:"Please provide a reason for rejecting this application."}),e.jsx(us,{children:e.jsx("div",{className:"sr-only",children:"Reject Application form"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Category"}),e.jsxs(hs,{value:u,onValueChange:f,children:[e.jsx(ps,{"data-testid":"select-rejection-category",children:e.jsx(js,{placeholder:"Select reason"})}),e.jsx(gs,{children:we.map(t=>e.jsx(fs,{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Explanation"}),e.jsx(ae,{value:C,onChange:t=>R(t.target.value),placeholder:"Provide additional details...","data-testid":"textarea-rejection-reason"})]})]}),e.jsxs(vs,{children:[e.jsx(p,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(p,{variant:"destructive",onClick:Ye,disabled:!u||j.isPending,"data-testid":"button-confirm-reject",children:"Confirm Rejection"})]})]})]})]}),s.status==="under_review"&&e.jsxs(p,{variant:"outline",onClick:Ge,disabled:j.isPending,"data-testid":"button-request-verification",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Request Verification"]})]})}),L&&e.jsx(y,{className:"p-4","data-testid":"card-applicant-actions",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-foreground",children:"Withdraw Application"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"You can withdraw your application if you no longer wish to proceed."})]}),e.jsxs(Ts,{open:a,onOpenChange:h,children:[e.jsx(Hs,{asChild:!0,children:e.jsxs(p,{variant:"outline",className:"text-orange-600 border-orange-300","data-testid":"button-withdraw",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Withdraw Application"]})}),e.jsxs(Os,{children:[e.jsxs(Fs,{children:[e.jsx(Ms,{children:"Withdraw Application"}),e.jsx(Ls,{children:"Are you sure you want to withdraw this application? This action cannot be undone. You may need to submit a new application if you change your mind."})]}),e.jsxs("div",{className:"py-4",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Reason (optional)"}),e.jsx(ae,{value:T,onChange:t=>A(t.target.value),placeholder:"Why are you withdrawing this application?","data-testid":"textarea-withdraw-reason"})]}),e.jsxs($s,{children:[e.jsx(Bs,{children:"Cancel"}),e.jsxs(Vs,{onClick:Je,className:"bg-orange-600 hover:bg-orange-700",disabled:j.isPending,"data-testid":"button-confirm-withdraw",children:[j.isPending?e.jsx(K,{className:"h-4 w-4 animate-spin mr-2"}):null,"Confirm Withdrawal"]})]})]})]})]})}),s.status==="withdrawn"&&e.jsxs(y,{className:"p-4 border-l-4 border-orange-500","data-testid":"card-withdrawn-info",children:[e.jsxs("h4",{className:"font-semibold mb-2 flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-orange-500"}),"Application Withdrawn"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This application was withdrawn and is no longer being considered."})]}),s.status==="rejected"&&s.rejectionDetails&&e.jsxs(y,{className:"p-4 border-l-4 border-red-500","data-testid":"card-rejection-details",children:[e.jsxs("h4",{className:"font-semibold mb-2 flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-red-500"}),"Rejection Details"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsx("strong",{children:"Category:"})," ",we.find(t=>t.value===s.rejectionCategory)?.label||s.rejectionCategory]}),s.rejectionReason&&e.jsx("p",{className:"text-sm mt-2",children:s.rejectionReason}),s.rejectionDetails?.appealable&&e.jsx(b,{variant:"outline",className:"mt-2",children:"Appealable"})]}),e.jsxs(ot,{type:"multiple",defaultValue:["personal","status-history"],className:"space-y-2",children:[e.jsxs(S,{value:"personal",children:[e.jsx(I,{className:"hover:no-underline",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ns,{className:"h-4 w-4"}),"Personal Information"]})}),e.jsx(P,{children:e.jsx("div",{className:"grid grid-cols-2 gap-4 p-4 bg-muted/50 rounded-md",children:s.personalInfo?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Full Name"}),e.jsx("p",{className:"font-medium",children:s.personalInfo.fullName||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Date of Birth"}),e.jsx("p",{className:"font-medium",children:s.personalInfo.dateOfBirth||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"SSN Provided"}),e.jsx("p",{className:"font-medium",children:s.personalInfo.ssn?"Yes (Hidden)":"No"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Phone"}),e.jsx("p",{className:"font-medium",children:s.personalInfo.phone||"N/A"})]})]}):e.jsx("p",{className:"text-muted-foreground col-span-2",children:"No personal information provided"})})})]}),e.jsxs(S,{value:"employment",children:[e.jsx(I,{className:"hover:no-underline",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),"Employment"]})}),e.jsx(P,{children:e.jsx("div",{className:"grid grid-cols-2 gap-4 p-4 bg-muted/50 rounded-md",children:s.employment?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Employer"}),e.jsx("p",{className:"font-medium",children:s.employment.employer||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Position"}),e.jsx("p",{className:"font-medium",children:s.employment.position||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Monthly Income"}),e.jsxs("p",{className:"font-medium",children:["$",(s.employment.monthlyIncome||0).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Years Employed"}),e.jsxs("p",{className:"font-medium",children:[s.employment.yearsEmployed||0," years"]})]})]}):e.jsx("p",{className:"text-muted-foreground col-span-2",children:"No employment information provided"})})})]}),e.jsxs(S,{value:"rental-history",children:[e.jsx(I,{className:"hover:no-underline",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-4 w-4"}),"Rental History"]})}),e.jsx(P,{children:e.jsx("div",{className:"grid grid-cols-2 gap-4 p-4 bg-muted/50 rounded-md",children:s.rentalHistory?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Current Address"}),e.jsx("p",{className:"font-medium",children:s.rentalHistory.currentAddress||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Landlord Name"}),e.jsx("p",{className:"font-medium",children:s.rentalHistory.landlordName||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Years Renting"}),e.jsxs("p",{className:"font-medium",children:[s.rentalHistory.yearsRenting||0," years"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Previous Eviction"}),e.jsx("p",{className:"font-medium",children:s.rentalHistory.hasEviction?e.jsx("span",{className:"text-red-600",children:"Yes"}):"No"})]})]}):e.jsx("p",{className:"text-muted-foreground col-span-2",children:"No rental history provided"})})})]}),e.jsxs(S,{value:"documents",children:[e.jsx(I,{className:"hover:no-underline",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),"Documents"]})}),e.jsx(P,{children:e.jsx("div",{className:"space-y-3 p-4 bg-muted/50 rounded-md",children:["id","proof_of_income","employment_verification","bank_statements"].map(t=>{const _=s.documentStatus?.[t]||s.documents?.[t],ee=_?.uploaded||!!_,je=_?.verified||!1;return e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm capitalize",children:t.replace(/_/g," ")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{variant:ee?"default":"outline",children:ee?"Uploaded":"Missing"}),ee&&e.jsx(b,{variant:je?"default":"secondary",children:je?"Verified":"Pending"})]})]},t)})})})]}),s.coApplicants&&s.coApplicants.length>0&&e.jsxs(S,{value:"co-applicants",children:[e.jsx(I,{className:"hover:no-underline",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(bs,{className:"h-4 w-4"}),"Co-Applicants (",s.coApplicants.length,")"]})}),e.jsx(P,{children:e.jsx("div",{className:"space-y-3 p-4 bg-muted/50 rounded-md",children:s.coApplicants.map(t=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.fullName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.email})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(b,{variant:"outline",children:t.relationship}),t.monthlyIncome&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["$",t.monthlyIncome.toLocaleString(),"/mo"]})]})]},t.id))})})]}),e.jsxs(S,{value:"status-history",children:[e.jsx(I,{className:"hover:no-underline",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),"Status History"]})}),e.jsx(P,{children:e.jsx("div",{className:"space-y-3 p-4",children:s.statusHistory&&s.statusHistory.length>0?s.statusHistory.map((t,_)=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary mt-2"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(b,{className:ne[t.status],children:Z(t.status)}),e.jsx("span",{className:"text-xs text-muted-foreground",children:H(t.changedAt)})]}),t.reason&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:t.reason})]})]},_)):e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary mt-2"}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(b,{className:ne[s.status],children:Z(s.status)}),e.jsx("span",{className:"text-xs text-muted-foreground",children:H(s.createdAt)})]})})]})})})]}),e.jsxs(S,{value:"comments",children:[e.jsx(I,{className:"hover:no-underline",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ys,{className:"h-4 w-4"}),"Notes (",s.comments?.length||0,")"]})}),e.jsx(P,{children:e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ae,{value:N,onChange:t=>k(t.target.value),placeholder:"Add a note...","data-testid":"textarea-new-comment"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:t=>D(t.target.checked),className:"rounded"}),"Internal note (not visible to applicant)"]}),e.jsx(p,{size:"sm",onClick:()=>pe.mutate(),disabled:!N.trim()||pe.isPending,"data-testid":"button-add-comment",children:"Add Note"})]})]}),s.comments&&s.comments.length>0?e.jsx("div",{className:"space-y-3 pt-4 border-t",children:s.comments.map(t=>e.jsxs("div",{className:`p-3 rounded-md ${t.isInternal?"bg-yellow-50 dark:bg-yellow-950 border border-yellow-200 dark:border-yellow-800":"bg-muted"}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm font-medium",children:t.users?.fullName||"Staff"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:H(t.createdAt)})]}),e.jsx("p",{className:"text-sm",children:t.content}),t.isInternal&&e.jsx(b,{variant:"outline",className:"mt-2 text-xs",children:"Internal"})]},t.id))}):e.jsx("p",{className:"text-muted-foreground text-sm",children:"No notes yet"})]})})]}),s.notifications&&s.notifications.length>0&&e.jsxs(S,{value:"notifications",children:[e.jsx(I,{className:"hover:no-underline",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ws,{className:"h-4 w-4"}),"Notifications (",s.notifications.length,")"]})}),e.jsx(P,{children:e.jsx("div",{className:"space-y-2 p-4 bg-muted/50 rounded-md",children:s.notifications.map(t=>e.jsxs("div",{className:"flex justify-between items-center py-2 border-b last:border-0",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:t.subject}),e.jsx("p",{className:"text-xs text-muted-foreground capitalize",children:t.notificationType.replace(/_/g," ")})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(b,{variant:t.status==="sent"?"default":"secondary",className:"text-xs",children:t.status}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:H(t.sentAt||t.createdAt)})]})]},t.id))})})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsx(Cs,{className:"h-4 w-4 inline mr-1"}),"Submitted: ",H(s.createdAt),s.reviewedAt&&e.jsxs("span",{className:"ml-4",children:["Reviewed: ",H(s.reviewedAt)]})]}),o&&e.jsx(p,{variant:"outline",onClick:o,"data-testid":"button-close-detail",children:"Close"})]})]})}function ft(){const[,s]=As("/applications/:id"),o=s?.id,{user:r,isLoading:n}=_e();x.useEffect(()=>{ks({title:"Application Details - Choice Properties",description:"View your rental application details and status."})},[]);const{data:l,isLoading:i,error:c,refetch:d}=Ds({queryKey:["/api/applications",o,"full"],queryFn:async()=>{const h=await Is(),u=await fetch(`/api/applications/${o}/full`,{headers:h?{Authorization:`Bearer ${h}`}:{},credentials:"include"});if(!u.ok)throw new Error("Failed to fetch application details");return u.json()},enabled:!!o&&!!r?.id}),a=l?.success?l.data:null;return n?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(z,{}),e.jsx("main",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(K,{className:"h-8 w-8 animate-spin text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading application details..."})]})})}),e.jsx(U,{})]}):r?c?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(z,{}),e.jsxs("main",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx(F,{href:"/applications",children:e.jsx(p,{variant:"ghost",size:"icon","data-testid":"button-back",children:e.jsx(ye,{className:"h-4 w-4"})})}),e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Application Details"})]}),e.jsx(y,{className:"border-l-4 border-l-red-500 bg-red-50 dark:bg-red-950",children:e.jsx($,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Rs,{className:"h-12 w-12 mx-auto text-red-600 dark:text-red-400 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-red-800 dark:text-red-200 mb-2",children:"Failed to Load Application"}),e.jsx("p",{className:"text-red-700 dark:text-red-300 mb-6",children:"We couldn't load this application. Please check the URL or go back to your applications list."}),e.jsx(F,{href:"/applications",children:e.jsx(p,{"data-testid":"button-back-to-applications",children:"Back to Applications"})})]})})})]}),e.jsx(U,{})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(z,{}),e.jsxs("main",{className:"container mx-auto px-4 py-8",children:[e.jsx(_s,{items:[{label:"Home",href:"/"},{label:"Applications",href:"/applications"},{label:"Application Details"}]}),e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx(F,{href:"/applications",children:e.jsx(p,{variant:"ghost",size:"icon","data-testid":"button-back",children:e.jsx(ye,{className:"h-4 w-4"})})}),e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Application Details"})]}),i?e.jsxs(y,{children:[e.jsxs(Ne,{children:[e.jsx(B,{className:"h-8 w-48"}),e.jsx(B,{className:"h-4 w-32 mt-2"})]}),e.jsxs($,{className:"space-y-4",children:[e.jsx(B,{className:"h-32 w-full"}),e.jsx(B,{className:"h-24 w-full"}),e.jsx(B,{className:"h-24 w-full"})]})]}):a?e.jsxs(y,{children:[e.jsx(Ne,{children:e.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[e.jsxs("div",{children:[e.jsx(Ss,{className:"text-xl","data-testid":"text-property-title",children:a.properties?.title||"Property Application"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[a.properties?.address,a.properties?.city&&`, ${a.properties.city}`,a.properties?.state&&`, ${a.properties.state}`]})]}),e.jsx(F,{href:`/properties/${a.property_id}`,children:e.jsx(p,{variant:"outline",size:"sm","data-testid":"button-view-property",children:"View Property"})})]})}),e.jsx($,{children:e.jsx(lt,{application:{id:a.id,userId:a.user_id,propertyId:a.property_id,status:a.status,previousStatus:a.previous_status,score:a.score,scoreBreakdown:a.score_breakdown,statusHistory:a.status_history,personalInfo:a.personal_info,employment:a.employment,rentalHistory:a.rental_history,documents:a.documents,documentStatus:a.document_status,rejectionCategory:a.rejection_category,rejectionReason:a.rejection_reason,rejectionDetails:a.rejection_details,createdAt:a.created_at,expiresAt:a.expires_at,reviewedAt:a.reviewed_at,users:a.users,properties:a.properties,coApplicants:a.coApplicants,comments:a.comments,notifications:a.notifications},onStatusChange:()=>d()})})]}):e.jsx(y,{children:e.jsxs($,{className:"py-12 text-center",children:[e.jsx(Y,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Application Not Found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"The application you are looking for does not exist or you do not have permission to view it."}),e.jsx(F,{href:"/applications",children:e.jsx(p,{"data-testid":"button-back-to-applications",children:"Back to Applications"})})]})})]}),e.jsx(U,{})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(z,{}),e.jsx("main",{className:"container mx-auto px-4 py-8",children:e.jsx(y,{className:"max-w-md mx-auto",children:e.jsxs($,{className:"pt-6 text-center",children:[e.jsx(Y,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Login Required"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Please log in to view application details."}),e.jsx(F,{href:"/login",children:e.jsx(p,{"data-testid":"button-login",children:"Log In"})})]})})}),e.jsx(U,{})]})}export{ft as default};
