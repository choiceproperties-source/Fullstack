import{r as l,j as e}from"./ui-DbSH5uIw.js";import{u as Z,z as G,a as Q,y as ee,N as F,K as R,C as m,Z as se,B as j,ai as T,aB as N,D as A,b as O,c as f,d as E,J as I,e as B,f as L,X as c,I as v,S as _,g as z,h as W,i as U,j as a,r as te,o as q,n as ie}from"./index-C3yA2dmm.js";import{a as ae}from"./query-C11-Me4M.js";import"./vendor-15WF5uYg.js";import"./charts-DfbWf95P.js";function oe(){const{isLoggedIn:g}=Z(),[,H]=G(),{toast:o}=Q(),[h,p]=l.useState({}),[i,r]=l.useState({}),[u,y]=l.useState([]),[J,K]=l.useState(!0);l.useEffect(()=>{ee({title:"Verify Payments - Choice Properties",description:"Verify tenant rent and deposit payments.",url:"https://choiceproperties.com/landlord-payments-verification"})},[]),l.useEffect(()=>{if(!g)return;(async()=>{try{const t=await fetch("/api/applications/landlord");if(t.ok){const n=await t.json(),d=Array.isArray(n.data)?n.data:[],w=[];for(const M of d){const S=await fetch(`/api/applications/${M.id}/payments`);if(S.ok){const V=await S.json(),X=Array.isArray(V.data)?V.data:[];w.push(...X.map(Y=>({...Y,propertyTitle:M.property?.title||"Unknown Property"})))}}y(w)}}catch{o({title:"Error",description:"Failed to load payments.",variant:"destructive"})}finally{K(!1)}})()},[o,g]);const x=ae({mutationFn:async({paymentId:s,amount:t,method:n,dateReceived:d})=>await te(`/api/v2/payments/${s}/verify`,"POST",{amount:t,method:n,dateReceived:d}),onSuccess:(s,t)=>{o({title:"Success",description:s.message||"Payment verified successfully."}),p({...h,[t.paymentId]:!1}),r({...i,[t.paymentId]:{amount:"",method:"",dateReceived:""}}),y(n=>n.map(d=>d.id===t.paymentId?{...d,status:"verified"}:d))},onError:()=>{o({title:"Error",description:"Failed to verify payment. Please try again.",variant:"destructive"})}});if(!g)return H("/login"),null;const D=s=>{const t=i[s];if(!t?.amount||!t?.method||!t?.dateReceived){o({title:"Validation Error",description:"Please fill in all fields.",variant:"destructive"});return}x.mutate({paymentId:s,...t})},P=s=>{switch(s){case"verified":return"bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-400";case"paid":return"bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-400";case"overdue":return"bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-400";default:return"bg-amber-100 dark:bg-amber-900 text-amber-700 dark:text-amber-400"}},$=s=>{switch(s){case"verified":return e.jsx(ie,{className:"w-4 h-4"});case"paid":return e.jsx(q,{className:"w-4 h-4"});case"overdue":return e.jsx(T,{className:"w-4 h-4"});default:return e.jsx(q,{className:"w-4 h-4"})}};if(J)return e.jsxs(e.Fragment,{children:[e.jsx(F,{}),e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading payments..."})}),e.jsx(R,{})]});const C=u.filter(s=>s.status==="paid"||s.status==="pending"),b=u.filter(s=>s.status==="overdue"),k=u.filter(s=>s.status==="verified");return e.jsxs(e.Fragment,{children:[e.jsx(F,{}),e.jsx("main",{className:"min-h-screen bg-background py-12",children:e.jsxs("div",{className:"container max-w-6xl mx-auto px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Verify Payments"}),e.jsx("p",{className:"text-muted-foreground",children:"Review and verify tenant rent and deposit payments"})]}),u.length===0?e.jsxs(m,{className:"p-8 text-center",children:[e.jsx(se,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"No Payments Found"}),e.jsx("p",{className:"text-muted-foreground",children:"You don't have any payments to verify yet."})]}):e.jsxs("div",{className:"space-y-8",children:[b.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Overdue Rent"}),e.jsx(j,{variant:"destructive",children:b.length})]}),e.jsx("div",{className:"space-y-3",children:b.map(s=>e.jsx(m,{className:"p-4 border-amber-200 dark:border-amber-800",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"font-semibold",children:s.type==="rent"?"Monthly Rent":"Security Deposit"}),e.jsx(j,{className:"bg-amber-100 dark:bg-amber-900 text-amber-700 dark:text-amber-400",children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(T,{className:"w-3 h-3"}),"Overdue"]})})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:s.propertyTitle}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Was due: ",N(new Date(s.dueDate),"MMMM dd, yyyy")]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold",children:["$",s.amount.toFixed(2)]}),e.jsxs(A,{open:h[s.id]||!1,onOpenChange:t=>p({...h,[s.id]:t}),children:[e.jsx(O,{asChild:!0,children:e.jsx(f,{size:"sm",className:"mt-2","data-testid":`button-verify-overdue-${s.id}`,children:"Verify"})}),e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsx(B,{children:"Verify Overdue Payment"}),e.jsxs(L,{children:[s.type==="rent"?"Monthly Rent":"Security Deposit"," - $",s.amount.toFixed(2)]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:`amount-${s.id}`,children:"Amount"}),e.jsx(v,{id:`amount-${s.id}`,type:"number",placeholder:"0.00",step:"0.01",value:i[s.id]?.amount||"",onChange:t=>r({...i,[s.id]:{...i[s.id],amount:t.target.value}}),"data-testid":`input-amount-overdue-${s.id}`})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:`method-${s.id}`,children:"Payment Method"}),e.jsxs(_,{value:i[s.id]?.method||"",onValueChange:t=>r({...i,[s.id]:{...i[s.id],method:t}}),children:[e.jsx(z,{id:`method-${s.id}`,"data-testid":`select-method-overdue-${s.id}`,children:e.jsx(W,{placeholder:"Select method"})}),e.jsxs(U,{children:[e.jsx(a,{value:"cash",children:"Cash"}),e.jsx(a,{value:"check",children:"Check"}),e.jsx(a,{value:"bank_transfer",children:"Bank Transfer"}),e.jsx(a,{value:"wire_transfer",children:"Wire Transfer"}),e.jsx(a,{value:"money_order",children:"Money Order"}),e.jsx(a,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:`date-${s.id}`,children:"Date Received"}),e.jsx(v,{id:`date-${s.id}`,type:"date",value:i[s.id]?.dateReceived||"",onChange:t=>r({...i,[s.id]:{...i[s.id],dateReceived:t.target.value}}),"data-testid":`input-date-overdue-${s.id}`})]}),e.jsx(f,{onClick:()=>D(s.id),disabled:x.isPending,className:"w-full","data-testid":`button-confirm-overdue-${s.id}`,children:x.isPending?"Verifying...":"Confirm Verification"})]})]})]})]})]})},s.id))})]}),C.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Awaiting Verification"}),e.jsx("div",{className:"space-y-3",children:C.map(s=>e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"font-semibold",children:s.type==="rent"?"Monthly Rent":"Security Deposit"}),e.jsx(j,{className:P(s.status),children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:[$(s.status),s.status.charAt(0).toUpperCase()+s.status.slice(1)]})})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:["Due: ",N(new Date(s.dueDate),"MMMM dd, yyyy")]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold mb-2",children:["$",s.amount.toFixed(2)]}),e.jsxs(A,{open:h[s.id]||!1,onOpenChange:t=>p({...h,[s.id]:t}),children:[e.jsx(O,{asChild:!0,children:e.jsx(f,{size:"sm","data-testid":`button-verify-payment-${s.id}`,children:"Verify"})}),e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsx(B,{children:"Verify Payment"}),e.jsxs(L,{children:[s.type==="rent"?"Monthly Rent":"Security Deposit"," - $",s.amount.toFixed(2)]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:`amount-${s.id}`,children:"Amount"}),e.jsx(v,{id:`amount-${s.id}`,type:"number",placeholder:"0.00",step:"0.01",value:i[s.id]?.amount||"",onChange:t=>r({...i,[s.id]:{...i[s.id],amount:t.target.value}}),"data-testid":`input-amount-${s.id}`})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:`method-${s.id}`,children:"Payment Method"}),e.jsxs(_,{value:i[s.id]?.method||"",onValueChange:t=>r({...i,[s.id]:{...i[s.id],method:t}}),children:[e.jsx(z,{id:`method-${s.id}`,"data-testid":`select-method-${s.id}`,children:e.jsx(W,{placeholder:"Select method"})}),e.jsxs(U,{children:[e.jsx(a,{value:"cash",children:"Cash"}),e.jsx(a,{value:"check",children:"Check"}),e.jsx(a,{value:"bank_transfer",children:"Bank Transfer"}),e.jsx(a,{value:"wire_transfer",children:"Wire Transfer"}),e.jsx(a,{value:"money_order",children:"Money Order"}),e.jsx(a,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:`date-${s.id}`,children:"Date Received"}),e.jsx(v,{id:`date-${s.id}`,type:"date",value:i[s.id]?.dateReceived||"",onChange:t=>r({...i,[s.id]:{...i[s.id],dateReceived:t.target.value}}),"data-testid":`input-date-${s.id}`})]}),e.jsx(f,{onClick:()=>D(s.id),disabled:x.isPending,className:"w-full","data-testid":`button-confirm-verify-${s.id}`,children:x.isPending?"Verifying...":"Confirm Verification"})]})]})]})]})]})},s.id))})]}),k.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Verified Payments"}),e.jsx("div",{className:"space-y-3",children:k.map(s=>e.jsx(m,{className:"p-4 opacity-75",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"font-semibold text-muted-foreground",children:s.type==="rent"?"Monthly Rent":"Security Deposit"}),e.jsx(j,{className:P(s.status),children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:[$(s.status),"Verified"]})})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Due: ",N(new Date(s.dueDate),"MMMM dd, yyyy")]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-2xl font-bold",children:["$",s.amount.toFixed(2)]})})]})},s.id))})]})]})]})}),e.jsx(R,{})]})}export{oe as default};
