import{r as n,j as e}from"./ui-DbSH5uIw.js";import{z as _,N as x,C as u,Y as g,c as h,K as f,n as q,v as b,I as j,E as N,ae as y}from"./index-C3yA2dmm.js";import{u as V}from"./forms-DE5E1-IR.js";import{t as Y,o as Z,s as v}from"./types-CF7YDNpg.js";import{F as z,a as P,b as k,c as S,d as C,e as E}from"./form-Dx3lF8C4.js";import{E as F}from"./eye-off-Bubmbnfp.js";import"./vendor-15WF5uYg.js";import"./query-C11-Me4M.js";import"./charts-DfbWf95P.js";const B=Z({password:v().min(8,"Password must be at least 8 characters").regex(/[A-Z]/,"Password must contain at least one uppercase letter").regex(/[0-9]/,"Password must contain at least one number"),confirmPassword:v().min(1,"Please confirm your password")}).refine(s=>s.password===s.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]}),G=s=>{let a=0;return s.length>=8&&a++,s.length>=12&&a++,/[A-Z]/.test(s)&&a++,/[0-9]/.test(s)&&a++,/[^A-Za-z0-9]/.test(s)&&a++,a};function X(){_();const[s,a]=n.useState(!1),[l,R]=n.useState(!1),[i,L]=n.useState(!1),[A,I]=n.useState(!1),[T,p]=n.useState(!1),r=V({resolver:Y(B),defaultValues:{password:"",confirmPassword:""}}),m=r.watch("password"),o=n.useMemo(()=>G(m),[m]);n.useEffect(()=>{(async()=>{const t=new URLSearchParams(window.location.hash.substring(1)),c=t.get("access_token");t.get("refresh_token"),t.get("type");const w=t.get("error_description");if(w){r.setError("root",{message:decodeURIComponent(w)}),p(!0);return}c||p(!0)})()},[r]);const U=async d=>{a(!0);try{if(!y)throw new Error("Authentication service unavailable");const{error:t}=await y.auth.updateUser({password:d.password});if(t)throw t;I(!0)}catch(t){r.setError("root",{message:t.message||"Failed to reset password"})}finally{a(!1)}};return T?e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx(x,{}),e.jsx("div",{className:"flex-1 flex items-center justify-center p-4 bg-gradient-to-br from-primary/5 to-secondary/5",children:e.jsxs(u,{className:"max-w-md w-full p-8 shadow-xl border-t-4 border-t-red-500 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Invalid or Expired Link"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"This password reset link is invalid or has expired. Please request a new password reset link."}),e.jsx(g,{href:"/forgot-password",children:e.jsx(h,{className:"w-full","data-testid":"button-request-new-link",children:"Request New Link"})})]})}),e.jsx(f,{})]}):A?e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx(x,{}),e.jsx("div",{className:"flex-1 flex items-center justify-center p-4 bg-gradient-to-br from-primary/5 to-secondary/5",children:e.jsxs(u,{className:"max-w-md w-full p-8 shadow-xl border-t-4 border-t-green-500 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(q,{className:"h-8 w-8 text-green-600"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Password Reset Successful"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Your password has been successfully updated. You can now sign in with your new password."}),e.jsx(g,{href:"/login",children:e.jsx(h,{className:"w-full","data-testid":"button-go-to-login",children:"Go to Login"})})]})}),e.jsx(f,{})]}):e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx(x,{}),e.jsx("div",{className:"flex-1 flex items-center justify-center p-4 bg-gradient-to-br from-primary/5 to-secondary/5",children:e.jsxs(u,{className:"max-w-md w-full p-8 shadow-xl border-t-4 border-t-primary",children:[e.jsx("h2",{className:"text-3xl font-bold text-primary mb-2",children:"Reset Password"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Create a strong password. It must be at least 8 characters and include an uppercase letter and a number."}),e.jsx(z,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(U),className:"space-y-4",children:[e.jsx(P,{control:r.control,name:"password",render:({field:d})=>e.jsxs(k,{children:[e.jsxs(S,{className:"font-semibold text-sm flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-4"})," New Password"]}),e.jsx(C,{children:e.jsxs("div",{className:"relative",children:[e.jsx(j,{type:l?"text":"password",placeholder:"At least 8 characters, with uppercase and number",disabled:s,autoComplete:"new-password","data-testid":"input-password",...d}),e.jsx("button",{type:"button",onClick:()=>R(!l),disabled:s,className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors","data-testid":"button-toggle-password","aria-label":l?"Hide password":"Show password",children:l?e.jsx(F,{className:"h-4 w-4"}):e.jsx(N,{className:"h-4 w-4"})})]})}),m&&e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsx("div",{className:"flex gap-1",children:[...Array(5)].map((t,c)=>e.jsx("div",{className:`h-1 flex-1 rounded-full transition-colors ${c<o?o<=2?"bg-red-500":o<=3?"bg-yellow-500":"bg-green-500":"bg-muted"}`},c))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:o===0?"Very weak":o===1?"Weak":o===2?"Fair":o===3?"Good":o===4?"Strong":"Very strong"})]}),e.jsx(E,{})]})}),e.jsx(P,{control:r.control,name:"confirmPassword",render:({field:d})=>e.jsxs(k,{children:[e.jsxs(S,{className:"font-semibold text-sm flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-4"})," Confirm New Password"]}),e.jsx(C,{children:e.jsxs("div",{className:"relative",children:[e.jsx(j,{type:i?"text":"password",placeholder:"Confirm your password",disabled:s,autoComplete:"new-password","data-testid":"input-confirm-password",...d}),e.jsx("button",{type:"button",onClick:()=>L(!i),disabled:s,className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors","data-testid":"button-toggle-confirm-password","aria-label":i?"Hide password":"Show password",children:i?e.jsx(F,{className:"h-4 w-4"}):e.jsx(N,{className:"h-4 w-4"})})]})}),e.jsx(E,{})]})}),r.formState.errors.root&&e.jsx("p",{className:"text-red-600 text-sm bg-red-50 dark:bg-red-950/50 p-3 rounded","data-testid":"text-error",children:r.formState.errors.root.message}),e.jsx(h,{type:"submit",className:"w-full",disabled:s,"data-testid":"button-submit",children:s?"Updating...":"Update Password"})]})})]})}),e.jsx(f,{})]})}export{X as default};
