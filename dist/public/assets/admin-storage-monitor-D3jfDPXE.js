import{j as e,r as p}from"./ui-DbSH5uIw.js";import{u as N}from"./query-C11-Me4M.js";import{ai as b,C as o,l as c,c as w,af as y,L as j,an as r,F as v,u as A,z as C}from"./index-C3yA2dmm.js";import"./vendor-15WF5uYg.js";import"./charts-DfbWf95P.js";function u({icon:a=b,title:l="Something went wrong",description:s="We encountered an error loading this content. Please try again.",onRetry:i,retryLabel:t="Try Again",fullPage:n=!1}){const d=e.jsx(o,{"data-testid":"error-state",children:e.jsxs(c,{className:"py-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-6 rounded-full bg-destructive/10 flex items-center justify-center",children:e.jsx(a,{className:"h-8 w-8 text-destructive"})}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2","data-testid":"text-error-title",children:l}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-sm mx-auto","data-testid":"text-error-description",children:s}),i&&e.jsxs(w,{onClick:i,"data-testid":"button-error-retry",children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),t]})]})});return n?e.jsx("div",{className:"min-h-[50vh] flex items-center justify-center px-4",children:e.jsx("div",{className:"max-w-md w-full",children:d})}):d}const S={unauthorized:{title:"Access Denied",description:"You don't have permission to view this content."}};function B({variant:a="spinner",count:l=3,message:s="Loading..."}){return a==="spinner"?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 gap-3",role:"status","aria-label":s,"data-testid":"loading-spinner",children:[e.jsx(j,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("span",{className:"text-muted-foreground",children:s})]}):a==="card"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",role:"status","aria-label":s,"data-testid":"loading-cards",children:Array.from({length:l}).map((i,t)=>e.jsxs(o,{className:"overflow-hidden",children:[e.jsx(r,{className:"aspect-[1.6/1]"}),e.jsxs(c,{className:"p-4 space-y-3",children:[e.jsx(r,{className:"h-5 w-3/4"}),e.jsx(r,{className:"h-4 w-1/2"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{className:"h-4 w-1/4"}),e.jsx(r,{className:"h-4 w-1/4"})]})]})]},t))}):a==="list"?e.jsx("div",{className:"space-y-3",role:"status","aria-label":s,"data-testid":"loading-list",children:Array.from({length:l}).map((i,t)=>e.jsx(o,{children:e.jsxs(c,{className:"p-4 flex items-center gap-4",children:[e.jsx(r,{className:"h-12 w-12 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(r,{className:"h-4 w-1/3"}),e.jsx(r,{className:"h-3 w-1/2"})]}),e.jsx(r,{className:"h-8 w-20"})]})},t))}):a==="table"?e.jsxs("div",{className:"border rounded-lg overflow-hidden",role:"status","aria-label":s,"data-testid":"loading-table",children:[e.jsx("div",{className:"bg-muted/50 p-4 flex gap-4",children:Array.from({length:4}).map((i,t)=>e.jsx(r,{className:"h-4 flex-1"},t))}),Array.from({length:l}).map((i,t)=>e.jsx("div",{className:"p-4 border-t flex gap-4",children:Array.from({length:4}).map((n,d)=>e.jsx(r,{className:"h-4 flex-1"},d))},t))]}):a==="form"?e.jsxs(o,{"data-testid":"loading-form",role:"status","aria-label":s,children:[e.jsx(v,{children:e.jsx(r,{className:"h-6 w-1/3"})}),e.jsxs(c,{className:"space-y-4",children:[Array.from({length:l}).map((i,t)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{className:"h-4 w-1/4"}),e.jsx(r,{className:"h-10 w-full"})]},t)),e.jsx(r,{className:"h-10 w-32"})]})]}):a==="page"?e.jsx("div",{className:"min-h-[50vh] flex items-center justify-center",role:"status","aria-label":s,"data-testid":"loading-page",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx(j,{className:"h-10 w-10 animate-spin text-primary"}),e.jsx("span",{className:"text-lg text-muted-foreground",children:s})]})}):null}function E(){const{user:a}=A(),[,l]=C();p.useEffect(()=>{a&&a.role!=="admin"&&l("/")},[a,l]);const{data:s,isLoading:i,error:t}=N({queryKey:["/api/admin/storage-metrics"],enabled:a?.role==="admin"}),n=m=>{if(m===0)return"0 B";const h=1024,f=["B","KB","MB","GB"],g=Math.floor(Math.log(m)/Math.log(h));return Math.round(m/Math.pow(h,g)*100)/100+" "+f[g]};if(!a||a.role!=="admin")return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(u,{...S.unauthorized})});if(i)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(B,{variant:"spinner",message:"Loading usage data..."})});if(t||!s)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(u,{title:"Data Unavailable",description:"Usage data is temporarily unavailable. Please try again later."})});const d=s.storagePercentage>70,x=s.storagePercentage>90;return e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-2xl",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6 text-foreground",children:"Admin: Storage & Bandwidth Monitor"}),e.jsxs(o,{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-3",children:"Storage Usage"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-foreground",children:[e.jsx("span",{className:"text-base",children:"Total Storage Used: "}),e.jsx("span",{className:"font-semibold",children:n(s.totalStorageUsed)})]}),e.jsxs("div",{className:"text-foreground",children:[e.jsx("span",{className:"text-base",children:"Usage Percentage: "}),e.jsxs("span",{className:"font-semibold",children:[s.storagePercentage.toFixed(1),"%"]})]})]}),x&&e.jsxs("div",{className:"mt-4 p-3 bg-red-100 dark:bg-red-900/30 border border-red-300 dark:border-red-700 rounded text-red-800 dark:text-red-200",children:[e.jsx("p",{className:"font-semibold",children:"CRITICAL: Storage usage exceeds 90% of free-tier limit."}),e.jsx("p",{className:"text-sm mt-1",children:"Upgrade or delete images immediately."})]}),d&&!x&&e.jsxs("div",{className:"mt-4 p-3 bg-yellow-100 dark:bg-yellow-900/30 border border-yellow-300 dark:border-yellow-700 rounded text-yellow-800 dark:text-yellow-200",children:[e.jsx("p",{className:"font-semibold",children:"WARNING: Storage usage exceeds 70% of free-tier limit."}),e.jsx("p",{className:"text-sm mt-1",children:"Consider upgrading or removing unused images."})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-3",children:"Images"}),e.jsxs("div",{className:"text-foreground",children:[e.jsx("span",{className:"text-base",children:"Total Images: "}),e.jsx("span",{className:"font-semibold",children:s.totalImages})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-3",children:"Estimated Bandwidth Usage"}),e.jsxs("div",{className:"text-foreground",children:[e.jsx("span",{className:"text-base",children:"Total Bandwidth (views Ã— size): "}),e.jsx("span",{className:"font-semibold",children:n(s.estimatedBandwidthUsed)})]})]})]})]})}export{E as default};
