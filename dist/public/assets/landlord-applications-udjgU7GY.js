import{r as g,j as e}from"./ui-DbSH5uIw.js";import{u as A,z as C,y as L,N as q,c,aG as S,C as h,O as n,o as u,aj as p,ai as j,n as f,m as b,K as R,p as E,M as F,B as d,al as U,E as B,L as D,Z as x}from"./index-C3yA2dmm.js";import{u as M}from"./use-property-applications-CwVe8zV7.js";import{A as T}from"./arrow-left-DiT6yHBU.js";import"./vendor-15WF5uYg.js";import"./query-C11-Me4M.js";import"./charts-DfbWf95P.js";function V(){const{user:i,isLoggedIn:v}=A(),[,l]=C(),{applications:o,isLoading:N,updateStatus:w,isUpdatingStatus:m}=M();g.useEffect(()=>{L({title:"Applications - Landlord Dashboard",description:"Review and manage rental applications from tenants",image:"https://choiceproperties.com/og-image.png",url:"https://choiceproperties.com/landlord-applications"})},[]);const s=g.useMemo(()=>{const t={pending:[],under_review:[],info_requested:[],conditional_approval:[],approved:[],rejected:[],other:[]};return o.forEach(a=>{a.status==="pending"||a.status==="submitted"||a.status==="payment_verified"?t.pending.push(a):a.status==="under_review"?t.under_review.push(a):a.status==="info_requested"?t.info_requested.push(a):a.status==="conditional_approval"?t.conditional_approval.push(a):a.status==="approved"?t.approved.push(a):a.status==="rejected"?t.rejected.push(a):t.other.push(a)}),t},[o]);if(!v||!i||i.role!=="landlord"&&i.role!=="property_manager"&&i.role!=="admin")return l("/login"),null;const y=t=>({pending:"bg-yellow-50 dark:bg-yellow-950 text-yellow-800 dark:text-yellow-200",submitted:"bg-blue-50 dark:bg-blue-950 text-blue-800 dark:text-blue-200",under_review:"bg-indigo-50 dark:bg-indigo-950 text-indigo-800 dark:text-indigo-200",info_requested:"bg-amber-50 dark:bg-amber-950 text-amber-800 dark:text-amber-200",conditional_approval:"bg-orange-50 dark:bg-orange-950 text-orange-800 dark:text-orange-200",approved:"bg-green-50 dark:bg-green-950 text-green-800 dark:text-green-200",rejected:"bg-red-50 dark:bg-red-950 text-red-800 dark:text-red-200"})[t]||"bg-gray-50 dark:bg-gray-950 text-gray-800 dark:text-gray-200",_=t=>{switch(t){case"approved":return e.jsx(f,{className:"h-4 w-4 text-green-600"});case"rejected":return e.jsx(b,{className:"h-4 w-4 text-red-600"});case"conditional_approval":return e.jsx(j,{className:"h-4 w-4 text-orange-600"});case"info_requested":return e.jsx(p,{className:"h-4 w-4 text-amber-600"});case"pending":case"under_review":case"submitted":return e.jsx(u,{className:"h-4 w-4 text-yellow-600"});default:return e.jsx(n,{className:"h-4 w-4"})}},k=t=>{switch(t){case"paid":return e.jsxs(d,{className:"bg-green-50 dark:bg-green-950 text-green-800 dark:text-green-200","data-testid":"badge-payment-paid",children:[e.jsx(x,{className:"h-3 w-3 mr-1"}),"Fee Paid"]});case"failed":return e.jsxs(d,{className:"bg-red-50 dark:bg-red-950 text-red-800 dark:text-red-200","data-testid":"badge-payment-failed",children:[e.jsx(x,{className:"h-3 w-3 mr-1"}),"Payment Failed"]});case"pending":default:return e.jsxs(d,{className:"bg-orange-50 dark:bg-orange-950 text-orange-800 dark:text-orange-200","data-testid":"badge-payment-pending",children:[e.jsx(x,{className:"h-3 w-3 mr-1"}),"Awaiting Fee"]})}},r=({app:t})=>e.jsxs(h,{className:"p-4 border-l-4",style:{borderLeftColor:t.status==="approved"?"#22c55e":t.status==="rejected"?"#ef4444":"#eab308"},"data-testid":`card-application-${t.id}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(E,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx("h3",{className:"font-semibold text-foreground truncate",children:t.users?.full_name||"Unknown Applicant"})]}),t.properties&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-2 mb-2",children:[e.jsx(n,{className:"h-3 w-3"}),t.properties.title]}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[e.jsx(F,{className:"h-3 w-3"}),t.users?.email]})]}),e.jsxs("div",{className:"flex flex-col gap-2 items-end",children:[e.jsx(d,{className:y(t.status),children:e.jsxs("span",{className:"flex items-center gap-1",children:[_(t.status),t.status.replace("_"," ").charAt(0).toUpperCase()+t.status.replace("_"," ").slice(1)]})}),k(t.payment_status)]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(U,{className:"h-3 w-3"}),new Date(t.created_at).toLocaleDateString()]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{size:"sm",variant:"outline",onClick:()=>l(`/application-review/${t.id}`),"data-testid":`button-view-${t.id}`,children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),"View Details"]}),(t.status==="pending"||t.status==="submitted"||t.status==="payment_verified")&&e.jsx(c,{size:"sm",onClick:()=>w({applicationId:t.id,status:"under_review"}),disabled:m,"data-testid":`button-review-${t.id}`,children:m?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"h-3 w-3 animate-spin mr-1"}),"Updating..."]}):"Start Review"})]})]})]},t.id);return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx(q,{}),e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-12",children:e.jsxs("div",{className:"container mx-auto px-4 flex items-center gap-4",children:[e.jsx(c,{onClick:()=>l("/landlord-dashboard"),variant:"ghost",size:"icon",className:"text-white hover:bg-white/20","data-testid":"button-back",children:e.jsx(T,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold",children:"Tenant Applications"}),e.jsx("p",{className:"text-blue-100 mt-2",children:"Review and manage tenant applications"})]})]})}),e.jsx("div",{className:"container mx-auto px-4 py-12 flex-1",children:N?e.jsx(S,{}):o.length===0?e.jsxs(h,{className:"p-12 text-center",children:[e.jsx(n,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-foreground font-semibold",children:"No applications yet"}),e.jsx("p",{className:"text-muted-foreground text-sm mt-2",children:"Applications from prospective tenants will appear here once they submit their applications for your properties."})]}):e.jsxs("div",{className:"space-y-8",children:[s.pending.length>0&&e.jsxs("div",{"data-testid":"section-pending",children:[e.jsxs("h2",{className:"text-2xl font-bold text-foreground mb-4 flex items-center gap-2",children:[e.jsx(u,{className:"h-6 w-6 text-yellow-600"}),"Pending Applications (",s.pending.length,")"]}),e.jsx("div",{className:"space-y-4",children:s.pending.map(t=>e.jsx(r,{app:t},t.id))})]}),s.under_review.length>0&&e.jsxs("div",{"data-testid":"section-under-review",children:[e.jsxs("h2",{className:"text-2xl font-bold text-foreground mb-4 flex items-center gap-2",children:[e.jsx(n,{className:"h-6 w-6 text-indigo-600"}),"Under Review (",s.under_review.length,")"]}),e.jsx("div",{className:"space-y-4",children:s.under_review.map(t=>e.jsx(r,{app:t},t.id))})]}),s.info_requested.length>0&&e.jsxs("div",{"data-testid":"section-info-requested",children:[e.jsxs("h2",{className:"text-2xl font-bold text-foreground mb-4 flex items-center gap-2",children:[e.jsx(p,{className:"h-6 w-6 text-amber-600"}),"Awaiting Information (",s.info_requested.length,")"]}),e.jsx("div",{className:"space-y-4",children:s.info_requested.map(t=>e.jsx(r,{app:t},t.id))})]}),s.conditional_approval.length>0&&e.jsxs("div",{"data-testid":"section-conditional-approval",children:[e.jsxs("h2",{className:"text-2xl font-bold text-foreground mb-4 flex items-center gap-2",children:[e.jsx(j,{className:"h-6 w-6 text-orange-600"}),"Conditional Approval (",s.conditional_approval.length,")"]}),e.jsx("div",{className:"space-y-4",children:s.conditional_approval.map(t=>e.jsx(r,{app:t},t.id))})]}),s.approved.length>0&&e.jsxs("div",{"data-testid":"section-approved",children:[e.jsxs("h2",{className:"text-2xl font-bold text-foreground mb-4 flex items-center gap-2",children:[e.jsx(f,{className:"h-6 w-6 text-green-600"}),"Approved (",s.approved.length,")"]}),e.jsx("div",{className:"space-y-4",children:s.approved.map(t=>e.jsx(r,{app:t},t.id))})]}),s.rejected.length>0&&e.jsxs("div",{"data-testid":"section-rejected",children:[e.jsxs("h2",{className:"text-2xl font-bold text-foreground mb-4 flex items-center gap-2",children:[e.jsx(b,{className:"h-6 w-6 text-red-600"}),"Rejected (",s.rejected.length,")"]}),e.jsx("div",{className:"space-y-4",children:s.rejected.map(t=>e.jsx(r,{app:t},t.id))})]}),s.other.length>0&&e.jsxs("div",{"data-testid":"section-other",children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-4",children:"Other"}),e.jsx("div",{className:"space-y-4",children:s.other.map(t=>e.jsx(r,{app:t},t.id))})]})]})}),e.jsx(R,{})]})}export{V as default};
